version: '3.9'

services:
  api:
    build: ./django-crud-api
    ports:
      - 8880:80

  locust-master:
    build: 
      context: ./locust-tests
      dockerfile: master.dockerfile
    depends_on:
      - api
    ports:
      - 8881:8881

  locust-worker:
    build:
      context: ./locust-tests
      dockerfile: worker.dockerfile
    depends_on:
      - api
      - locust-master
    deploy:
      mode: replicated
      replicas: 5
      